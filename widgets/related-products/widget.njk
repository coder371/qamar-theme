{# Related Products Widget #}

{% set relatedProducts = product.relatedProducts | default([]) %}
{% set productsCount = widget.data.products_count | default(4) %}
{% set isSlider = widget.data.show_as_slider | default(true) %}

{% if relatedProducts | length > 0 %}
<section class="py-12 bg-surface">
  <div class="container mx-auto px-4">
    {# Section Header #}
    <div class="flex items-center justify-between mb-8">
      <h2 class="text-2xl md:text-3xl font-bold text-gray-900">
        {{ widget.data.title | default('منتجات ذات صلة') }}
      </h2>

      {% if isSlider and relatedProducts | length > productsCount %}
        <div class="flex gap-2">
          <button
            @click="$refs.slider.scrollBy({ left: -300, behavior: 'smooth' })"
            class="w-10 h-10 rounded-full bg-white shadow-md flex items-center justify-center hover:bg-primary hover:text-white transition-colors">
            <svg class="w-5 h-5 rtl:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
          </button>
          <button
            @click="$refs.slider.scrollBy({ left: 300, behavior: 'smooth' })"
            class="w-10 h-10 rounded-full bg-white shadow-md flex items-center justify-center hover:bg-primary hover:text-white transition-colors">
            <svg class="w-5 h-5 rtl:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </button>
        </div>
      {% endif %}
    </div>

    {# Products #}
    {% if isSlider %}
      {# Slider View #}
      <div
        x-ref="slider"
        class="flex gap-4 overflow-x-auto pb-4 scroll-smooth snap-x snap-mandatory hide-scrollbar"
        style="-webkit-overflow-scrolling: touch;">
        {% for item in relatedProducts | slice(0, productsCount) %}
          <div class="w-[280px] flex-shrink-0 snap-start">
            {% ui "product-card.njk", product=item %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      {# Grid View #}
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
        {% for item in relatedProducts | slice(0, productsCount) %}
          {% ui "product-card.njk", product=item %}
        {% endfor %}
      </div>
    {% endif %}
  </div>
</section>
{% endif %}

<style>
  .hide-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .hide-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>
